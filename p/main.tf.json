{
  "terraform": {
    "required_providers": {
      "aws": {
        "version": "~> 3.60.0",
        "source": "aws"
      }
    }
  },
  "provider": {
    "aws": [
      {
        "region": "us-west-2"
      }
    ]
  },
  "resource": {
    "aws_organizations_organization": {
      "org": {
        "aws_service_access_principals": [
          "cloudtrail.amazonaws.com",
          "config.amazonaws.com",
          "ram.amazonaws.com",
          "ssm.amazonaws.com",
          "sso.amazonaws.com",
          "tagpolicies.tag.amazonaws.com"
        ],
        "enabled_policy_types": ["SERVICE_CONTROL_POLICY", "TAG_POLICY"],
        "feature_set": "ALL"
      }
    },
    "aws_ssoadmin_permission_set": {
      "admin_sso_permission_set": {
        "instance_arn": "${[ for e in data.aws_ssoadmin_instances.sso_instance.arns: e ][0]}",
        "name": "Administrator",
        "session_duration": "PT2H",
        "tags": {
          "ManagedBy": "Terraform"
        }
      }
    },
    "aws_ssoadmin_managed_policy_attachment": {
      "admin_sso_managed_policy_attachment": {
        "instance_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.instance_arn}",
        "managed_policy_arn": "arn:aws:iam::aws:policy/AdministratorAccess",
        "permission_set_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.arn}"
      }
    },
    "aws_organizations_account": {
      "katt": {
        "email": "katt@defn.sh",
        "name": "katt",
        "tags": {
          "ManagedBy": "Terraform"
        }
      },
      "net": {
        "email": "katt+net@defn.sh",
        "iam_user_access_to_billing": "ALLOW",
        "name": "net",
        "role_name": "OrganizationAccountAccessRole",
        "tags": {
          "ManagedBy": "Terraform"
        }
      },
      "log": {
        "email": "katt+log@defn.sh",
        "iam_user_access_to_billing": "ALLOW",
        "name": "log",
        "role_name": "OrganizationAccountAccessRole",
        "tags": {
          "ManagedBy": "Terraform"
        }
      },
      "lib": {
        "email": "katt+lib@defn.sh",
        "iam_user_access_to_billing": "ALLOW",
        "name": "lib",
        "role_name": "OrganizationAccountAccessRole",
        "tags": {
          "ManagedBy": "Terraform"
        }
      },
      "ops": {
        "email": "katt+ops@defn.sh",
        "iam_user_access_to_billing": "ALLOW",
        "name": "ops",
        "role_name": "OrganizationAccountAccessRole",
        "tags": {
          "ManagedBy": "Terraform"
        }
      },
      "sec": {
        "email": "katt+sec@defn.sh",
        "iam_user_access_to_billing": "ALLOW",
        "name": "sec",
        "role_name": "OrganizationAccountAccessRole",
        "tags": {
          "ManagedBy": "Terraform"
        }
      },
      "hub": {
        "email": "katt+hub@defn.sh",
        "iam_user_access_to_billing": "ALLOW",
        "name": "hub",
        "role_name": "OrganizationAccountAccessRole",
        "tags": {
          "ManagedBy": "Terraform"
        }
      },
      "pub": {
        "email": "katt+pub@defn.sh",
        "iam_user_access_to_billing": "ALLOW",
        "name": "pub",
        "role_name": "OrganizationAccountAccessRole",
        "tags": {
          "ManagedBy": "Terraform"
        }
      },
      "dev": {
        "email": "katt+dev@defn.sh",
        "iam_user_access_to_billing": "ALLOW",
        "name": "dev",
        "role_name": "OrganizationAccountAccessRole",
        "tags": {
          "ManagedBy": "Terraform"
        }
      },
      "dmz": {
        "email": "katt+dmz@defn.sh",
        "iam_user_access_to_billing": "ALLOW",
        "name": "dmz",
        "role_name": "OrganizationAccountAccessRole",
        "tags": {
          "ManagedBy": "Terraform"
        }
      }
    },
    "aws_ssoadmin_account_assignment": {
      "katt_admin_sso_account_assignment": {
        "instance_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.instance_arn}",
        "permission_set_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.arn}",
        "principal_id": "${data.aws_identitystore_group.administrators_sso_group.group_id}",
        "principal_type": "GROUP",
        "target_id": "${aws_organizations_account.katt.id}",
        "target_type": "AWS_ACCOUNT"
      },
      "net_admin_sso_account_assignment": {
        "instance_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.instance_arn}",
        "permission_set_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.arn}",
        "principal_id": "${data.aws_identitystore_group.administrators_sso_group.group_id}",
        "principal_type": "GROUP",
        "target_id": "${aws_organizations_account.net.id}",
        "target_type": "AWS_ACCOUNT"
      },
      "log_admin_sso_account_assignment": {
        "instance_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.instance_arn}",
        "permission_set_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.arn}",
        "principal_id": "${data.aws_identitystore_group.administrators_sso_group.group_id}",
        "principal_type": "GROUP",
        "target_id": "${aws_organizations_account.log.id}",
        "target_type": "AWS_ACCOUNT"
      },
      "lib_admin_sso_account_assignment": {
        "instance_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.instance_arn}",
        "permission_set_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.arn}",
        "principal_id": "${data.aws_identitystore_group.administrators_sso_group.group_id}",
        "principal_type": "GROUP",
        "target_id": "${aws_organizations_account.lib.id}",
        "target_type": "AWS_ACCOUNT"
      },
      "ops_admin_sso_account_assignment": {
        "instance_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.instance_arn}",
        "permission_set_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.arn}",
        "principal_id": "${data.aws_identitystore_group.administrators_sso_group.group_id}",
        "principal_type": "GROUP",
        "target_id": "${aws_organizations_account.ops.id}",
        "target_type": "AWS_ACCOUNT"
      },
      "sec_admin_sso_account_assignment": {
        "instance_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.instance_arn}",
        "permission_set_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.arn}",
        "principal_id": "${data.aws_identitystore_group.administrators_sso_group.group_id}",
        "principal_type": "GROUP",
        "target_id": "${aws_organizations_account.sec.id}",
        "target_type": "AWS_ACCOUNT"
      },
      "hub_admin_sso_account_assignment": {
        "instance_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.instance_arn}",
        "permission_set_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.arn}",
        "principal_id": "${data.aws_identitystore_group.administrators_sso_group.group_id}",
        "principal_type": "GROUP",
        "target_id": "${aws_organizations_account.hub.id}",
        "target_type": "AWS_ACCOUNT"
      },
      "pub_admin_sso_account_assignment": {
        "instance_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.instance_arn}",
        "permission_set_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.arn}",
        "principal_id": "${data.aws_identitystore_group.administrators_sso_group.group_id}",
        "principal_type": "GROUP",
        "target_id": "${aws_organizations_account.pub.id}",
        "target_type": "AWS_ACCOUNT"
      },
      "dev_admin_sso_account_assignment": {
        "instance_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.instance_arn}",
        "permission_set_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.arn}",
        "principal_id": "${data.aws_identitystore_group.administrators_sso_group.group_id}",
        "principal_type": "GROUP",
        "target_id": "${aws_organizations_account.dev.id}",
        "target_type": "AWS_ACCOUNT"
      },
      "dmz_admin_sso_account_assignment": {
        "instance_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.instance_arn}",
        "permission_set_arn": "${aws_ssoadmin_permission_set.admin_sso_permission_set.arn}",
        "principal_id": "${data.aws_identitystore_group.administrators_sso_group.group_id}",
        "principal_type": "GROUP",
        "target_id": "${aws_organizations_account.dmz.id}",
        "target_type": "AWS_ACCOUNT"
      }
    }
  },
  "data": {
    "aws_ssoadmin_instances": {
      "sso_instance": {}
    },
    "aws_identitystore_group": {
      "administrators_sso_group": {
        "identity_store_id": "${[ for e in data.aws_ssoadmin_instances.sso_instance.identity_store_ids: e ][0]}",
        "filter": [
          {
            "attribute_path": "DisplayName",
            "attribute_value": "Administrators"
          }
        ]
      }
    }
  }
}
