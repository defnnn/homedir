#!/usr/bin/env bash

function main {
  set -efu

  if [[ "$(id -un)" = "cloudshell-user" ]]; then
    sudo yum upgrade -y
    sudo yum install -y rsync
  fi

  PATH="$HOME/.asdf/installs/bin:$PATH"
  PATH="/home/linuxbrew/.linuxbrew/sbin:/home/linuxbrew/.linuxbrew/bin:/home/linuxbrew/.linuxbrew/opt/java/bin:$PATH"

  rsync -ia homedir/.git .
  git reset --hard
  rm -f .zshrc

  if [[ "$(id -un)" = "cloudshell-user" ]]; then
    curl -sSL -o bin/powerline-go https://github.com/justjanne/powerline-go/releases/download/v1.18.0/powerline-go-linux-amd64
    chmod 755 bin/powerline-go
  fi

  make update
  rm -rf homedir
}

main "$@"
