#!/usr/bin/env bash

function main {
  set -efu

  local cfg="$(mktemp -t XXXXXXXXX)"

  trap EXIT "rm -f $cfg"

  cp "$HOME/.kube/config" "${cfg}"

  export KUBECONFIG="${cfg}"
  ktx "${0##*/}" >/dev/null

  case "${1:-}" in
    all)
      k get --all-namespaces $(k api-resources --verbs=list --namespaced -o name | grep -v events | xargs | sed 's# #,#g')
      ;;
    k*|helm|kustomize|linkerd|glooctl|bash|*make|argo*|cilium*|hubble*)
      "$@"
      ;;
    e|exec)
      shift
      "$@"
      ;;
    *)
      k "$@"
      ;;
  esac
}

main "$@"
