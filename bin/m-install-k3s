#!/usr/bin/env bash

function main {
  set -exfu

  local mphost="$1"; shift
  
  local mpip="$(m list --format json | jq -r --arg mp $mphost '.list[] | select(.name == $mp) | .ipv4[0]')"

  k3sup install --cluster \
    --ip $mpip --user ubuntu --cluster \
    --k3s-extra-args "--flannel-backend=none --disable-network-policy --disable traefik --disable servicelb --bind-address=$mpip --advertise-address=$mpip --node-ip=$mpip" "$@"
}

main "$@"
